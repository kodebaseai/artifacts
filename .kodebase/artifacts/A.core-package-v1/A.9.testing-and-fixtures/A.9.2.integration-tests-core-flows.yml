metadata:
  title: Integration tests for core flows
  priority: high
  estimation: M
  created_by: "Miguel Carvalho (m@kodebase.ai)"
  assignee: "Miguel Carvalho (m@kodebase.ai)"
  schema_version: "0.0.1"
  relationships:
    blocks: [A.9.3]
    blocked_by: [A.9.1]
  events:
    - event: draft
      timestamp: "2025-10-28T10:45:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: artifact_created
    - event: blocked
      timestamp: "2025-10-28T14:44:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: has_dependencies
      metadata:
        blocking_dependencies:
          - artifact_id: A.9.1
            resolved: true
    - event: ready
      timestamp: "2025-11-02T00:14:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: dependencies_met
    - event: in_progress
      timestamp: "2025-11-02T00:16:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: branch_created
    - event: in_review
      timestamp: "2025-11-02T00:39:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: pr_ready
    - event: completed
      timestamp: "2025-11-02T00:43:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: pr_merged
content:
  summary: >-
    Add end-to-end tests covering the primary flows: create→validate, start→cascade,
    and complete→cascade using the sample fixtures and core helpers.
  acceptance_criteria:
    - 'Validation: new artifacts with draft only → post-merge ready/blocked computation passes'
    - 'Cascade: last issue completed → milestone/initiative get in_review recommendations'
    - 'Completion: completion info present → completed event appended (simulated)'
    - 'Tests run under Vitest; no network, deterministic results'
implementation_notes:
  result: "16 integration tests covering validation, cascade, and completion flows with 100% pass rate"
  challenges:
    - challenge: "Initial test imports referenced wrong module paths"
      solution: "User corrected imports to use centralized constants.js instead of scattered type files"
    - challenge: "API signature mismatches with CascadeEngine methods"
      solution: "Fixed shouldCascadeToParent signature (children[], parentState) and return type (CascadeDecision)"
    - challenge: "Double-parsing YAML from readArtifact"
      solution: "Removed parseYaml calls - readArtifact<T> already returns parsed data"
    - challenge: "Missing resolutionTimestamp parameter in dependency resolution"
      solution: "Added timestamp parameter to all resolveDependencyCompletion calls"
  insights:
    - "Import organization matters - centralized constants prevent type mismatches and import errors"
    - "Integration tests should verify structure/behavior, not schema compliance - leave validation to CLI layer"
    - "Helper functions (buildChild, sequence, buildBlockedDependent) reduce test duplication significantly"
    - "Fake timers (vi.useFakeTimers) ensure deterministic timestamp generation in tests"
    - "structuredClone snapshots verify immutability without complex mocking"
  tags: [integration-tests, vitest, cascade-engine, fixtures, core-flows, testing]
