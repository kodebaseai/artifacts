metadata:
  title: Foundation Services
  priority: critical
  estimation: M
  created_by: "Miguel Carvalho (m@kodebase.ai)"
  assignee: "Miguel Carvalho (m@kodebase.ai)"
  schema_version: "0.0.1"
  relationships:
    blocks: [B.2, B.3]
    blocked_by: []
  events:
    - event: draft
      timestamp: "2025-11-02T11:56:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: artifact_created
    - event: in_progress
      timestamp: "2025-11-02T17:44:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: children_started
    - event: in_review
      timestamp: "2025-11-02T23:19:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: children_completed
    - event: completed
      timestamp: "2025-11-02T23:45:00Z"
      actor: "Miguel Carvalho (m@kodebase.ai)"
      trigger: pr_merged
content:
  summary: >-
    Establish core CRUD and validation operations that all other services depend on.
  deliverables:
    - ArtifactService with CRUD, event, and metadata operations
    - ValidationService orchestrating schema, readiness, state machine, and dependency checks
    - Error formatting utilities (ArtifactError, formatters)
  validation:
    - All ArtifactService methods tested with core fixtures
    - ValidationService orchestrates all 4 core validators
    - Error messages include artifact context and suggested fixes
    - Integration test (create → validate → update) passes
delivery_summary:
  outcome: Foundation services shipped with complete CRUD operations, orchestrated validation, user-friendly error formatting, and ESM-only package configuration enabling downstream CLI and workflow automation.
  delivered:
    - ArtifactService with createArtifact, getArtifact, updateMetadata, and appendEvent methods achieving 96.77% test coverage using memfs for fast, isolated tests.
    - ValidationService orchestrating schema validation, dependency validation (circular, cross-level, consistency), and state machine validation with aggregated error reporting.
    - Error formatting utilities including ArtifactError class, formatValidationErrors/Warnings for CLI output, formatSchemaError for Zod conversion, and createUserFriendlyError wrapper achieving 98.79% coverage.
    - ESM-only package setup with tree-shakable exports (sideEffects: false), TypeScript strict mode, attw validation using esm-only profile, zero circular dependencies, and full monorepo convention compliance.
    - Bonus fix for @kodebase/core package attw configuration resolving CI pipeline failures that blocked npm publication.
  next: Integrate ArtifactService and ValidationService into B.2 (artifact template commands) and B.3 (query/reporting services) to enable end-to-end CLI workflows.
  risks:
    - Consumers must handle async operations correctly as all service methods return Promises requiring proper await/async patterns.
    - ESM-only distribution requires CommonJS consumers to use dynamic import() which may require code changes in synchronous contexts.
