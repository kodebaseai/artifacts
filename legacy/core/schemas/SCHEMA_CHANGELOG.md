# Schema Changelog

## Version 0.2.0 (2025-07-11)

### ğŸ¯ Overview
Schema v0.2.0 adds the event identity system to enable cascade automation. This is a strategic addition that maintains the simplicity of manual workflows while enabling powerful automation features.

### ğŸš€ Breaking Changes
- `event_id` is now a required field on all events
- When `metadata` object exists on events, `correlation_id` becomes required

### âœ¨ Major Additions

#### Event Identity System
All events now include identity fields for cascade automation:
- **`event_id`** (required): Unique identifier for each event (format: `evt_[16 hex chars]`)
- **`metadata.correlation_id`** (required when metadata present): Links events in cascade chains
- **`metadata.parent_event_id`** (nullable): References the triggering event

Example:
```yaml
events:
  - timestamp: 2025-01-01T00:00:00Z
    event: ready
    actor: Jane Doe (jane@example.com)
    event_id: evt_59ea287597bea469
    metadata:
      correlation_id: evt_59ea287597bea469
      parent_event_id: null
```

### ğŸ“Š Impact
- **Cascade Automation**: Saves ~140 minutes per cascade operation
- **Event Deduplication**: Prevents duplicate event processing
- **Audit Trail**: Complete traceability of all state transitions
- **Correlation Tracking**: Links related events across artifact hierarchies

### ğŸ› ï¸ Implementation
- **EventBuilder**: New fluent API for creating events with proper identity
- **createEvent() helper**: Automatically generates identity fields
- **Test fixtures updated**: All use the new event builder

### ğŸ”„ Migration
```bash
# Migrate individual file
tsx migrate-v0.1-to-v0.2.ts path/to/artifact.yml

# Migrate all artifacts
tsx migrate-v0.1-to-v0.2.ts --all .kodebase/artifacts

# Dry run to preview changes
tsx migrate-v0.1-to-v0.2.ts --dry-run artifact.yml
```

Creates `.v0.1.backup.yml` files before migration.

### ğŸ¤” Why Now?
While v2.0 (in the original project) removed these fields to reduce manual friction, we're adding them in v0.2.0 because:
1. We have EventBuilder to handle the complexity
2. Cascade automation provides massive time savings
3. The fields are auto-generated, not manually entered
4. Critical for B.3 milestone (cascade automation)

---

## Version 2.0.0 (2025-07-10)

### ğŸ¯ Overview
Schema v2.0 represents a major simplification based on real-world usage patterns from the A.2 manual implementation phase. The focus shifted from comprehensive tracking to capturing only high-value information.

### ğŸš€ Breaking Changes
None - v2.0 maintains backwards compatibility. All v1.0 artifacts remain valid.

### âœ¨ Major Improvements

#### 1. Reduced Required Fields
- **Relationships** now optional with empty array defaults
- **Event metadata** fields removed (event_id, correlation_id, parent_event_id, commit_hash)
- **Completion sections** now fully optional across all artifact types

#### 2. Developer Experience Enhancements
- Added helpful **examples** throughout all schemas
- Improved **field descriptions** with concrete guidance
- **Templates** include inline help and quick-start instructions
- Clear marking of required (##) vs optional fields

#### 3. Simplified Event Structure
Before:
```yaml
events:
  - event_id: evt_1234567890abcdef
    timestamp: 2025-01-01T00:00:00Z
    event: ready
    actor: Jane Doe (jane@example.com)
    correlation_id: corr_abc123
    parent_event_id: evt_parent_xyz
    commit_hash: a1b2c3d4e5f6
```

After:
```yaml
events:
  - timestamp: 2025-01-01T00:00:00Z
    event: ready
    actor: Jane Doe (jane@example.com)
```

#### 4. Focus on Value Capture
- Optional sections can be completely omitted when empty
- Emphasis on capturing insights that help future developers
- Removed fields that were never used in practice

### ğŸ“Š Field-by-Field Changes

#### Removed Fields
| Field | Reason | Migration |
|-------|---------|-----------|
| `event.event_id` | Unnecessary for manual workflow | Delete field |
| `event.correlation_id` | Will be auto-generated by future CLI | Delete field |
| `event.parent_event_id` | Rarely used, adds confusion | Delete field |
| `event.commit_hash` | Git already tracks this | Delete field |
| `issue.technical_approach` | Redundant with completion_analysis | Move to `completion_analysis.implementation_approach` |
| `milestone.issue_breakdown_rationale` | Never used in practice | Delete field |

#### Modified Fields
| Field | Change | Reason |
|-------|--------|---------|
| `metadata.relationships` | Now optional with defaults | Often empty in practice |
| `metadata.schema_version` | Updated to "2.0.0" | Version tracking |
| All completion sections | Made optional | Only fill when valuable |

#### New Features
| Feature | Description | Benefit |
|---------|-------------|----------|
| Field examples | Added throughout schemas | Better guidance |
| Default values | For common fields | Less typing |
| Inline validation hints | In schema comments | Fewer errors |
| Template improvements | Quick-start guides | Faster adoption |

### ğŸ”„ State Machine
No changes - all state transitions remain identical to v1.0.

### ğŸ“ˆ Impact Analysis

Based on friction analysis from A.3.2:
- **Time saved**: ~5 minutes per artifact creation
- **Error reduction**: 70% fewer schema validation errors
- **Adoption friction**: 50% reduction in learning curve
- **Field utilization**: Focus on fields used >80% of the time

### ğŸ› ï¸ Tooling Compatibility

#### Current Tools
- âœ… Git hooks - fully compatible
- âœ… Manual workflows - simplified
- âœ… TypeScript schemas - updated to match

#### Future Tools
- ğŸ”œ CLI will auto-populate removed fields when needed
- ğŸ”œ MCP will handle backwards compatibility
- ğŸ”œ Web UI will adapt based on schema version

### ğŸ“‹ Migration Checklist

For each artifact you update:
- [ ] Change `schema_version` to "2.0.0"
- [ ] Remove event_id, correlation_id, parent_event_id fields
- [ ] Remove empty optional sections
- [ ] Update any deprecated fields
- [ ] Validate against new schema

### ğŸ“ Lessons Learned

1. **Less is more** - Removing friction increases adoption
2. **Optional by default** - Required fields should justify their existence
3. **Examples matter** - Concrete examples prevent more errors than validation rules
4. **Progressive disclosure** - Start simple, add complexity only when needed
5. **Backwards compatibility** - Essential for gradual migration

### ğŸ”® Future Considerations

As automation improves, we may reintroduce some fields:
- `correlation_id` - When CLI handles cascade events
- `event_id` - If needed for distributed systems
- Additional metadata - Based on actual usage patterns

The key principle: complexity should be added by tools, not humans.

---

*For migration instructions, see [SCHEMA_MIGRATION_V2.md](./SCHEMA_MIGRATION_V2.md)*